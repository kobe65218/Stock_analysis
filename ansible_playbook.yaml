- hosts: gwc
  tasks:

    - name: git pull
      git:
        repo: "https://github.com/kobe65218/Stock_analysis.git"
        dest: /home/kobe655218/Stock_analysis
        update: yes
        version: docker

    - name: Down container
      become: True
      shell:
          chdir: /home/kobe655218/Stock_analysis
          cmd: docker-compose down
      register: message


    - name: set env
      become: True
      shell:
        chdir: /home/kobe655218/Stock_analysis
        cmd: echo -e "AIRFLOW_UID=$(id -u)\nAIRFLOW_GID=0" > .env


    - name: init airflow
      become: True
      shell:
        chdir: /home/kobe655218/Stock_analysis
        cmd: docker-compose up airflow-init


    - name: up container
      become: True
      shell:
        cmd: docker-compose  up -d
        chdir: /home/kobe655218/Stock_analysis
